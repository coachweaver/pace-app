<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Race Pace Calculator</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="theme-color" content="#00205b" />

<style>
  :root{
    --white:#ffffff;
    --off:#fafafa;
    --ink:#00205b;
    --muted:#415a8a;
    --gold:#e9dd90;     /* final 50 */
    --sky:#8dc8e8;      /* active button background */
    --border:#e6e6e6;
    --danger:#b00020;
    --light-green:#e8f5e9;   /* first 50 */
    --light-yellow:#fffbe6;  /* middle 50s */
    --control-w: clamp(260px, 90vw, 360px); /* unified width for controls */
    --card-w: min(920px, 100%);
  }

  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--white);
    color: var(--ink);
    min-height: 100dvh;
    padding: 0;
  }

  .wrap{
    max-width: var(--card-w);
    margin: 0 auto;
    padding: clamp(12px, 3vw, 24px);
    padding-top: calc(max(12px, env(safe-area-inset-top)));
  }

  .card{
    width: 100%;
    background: linear-gradient(180deg, rgba(0,32,91,.02), rgba(0,32,91,.00));
    border:1px solid var(--border);
    border-radius:20px;
    box-shadow: 0 16px 40px rgba(0,0,0,.06);
    padding: clamp(18px, 2.5vw, 28px);
  }

  /* Badge */
  .logo{
    display:block;
    margin: max(6px, env(safe-area-inset-top)) auto 12px auto;
    width:min(140px, 42vw);
    height:auto;
  }

  h1{
    margin:6px 0 16px 0;
    text-align:center;
    font-size:clamp(20px,4.5vw,28px);
  }

  /* Controls section — always centered and same width */
  .controls{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
    margin: 8px 0 16px;
  }

  .field{ width: var(--control-w); }

  .field label{
    display:block;
    font-size:14px;
    color:var(--muted);
    margin:0 0 6px 2px;
    text-align:center;
  }

  /* Event buttons grid (2 x 3) */
  .event-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }
  @media (min-width:600px){
    .event-grid{ grid-template-columns: repeat(3, 1fr); }
  }

  .btn{
    display:inline-block;
    width:100%;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid var(--border);
    background:#fff;
    color:var(--ink);
    font-size:16px;
    text-align:center;
    cursor:pointer;
    user-select:none;
    transition: box-shadow .2s ease, transform .02s ease, background .2s ease;
  }
  .btn:active{ transform: translateY(1px) }
  .btn--active{
    background: var(--sky);
    border-color: #7ab9d9;
  }

  /* Course buttons (shown only for 400/500) stacked vertically */
  .course-buttons{
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  /* State cuts (expandable) — fully centered */
  .cuts-wrap{
    display:flex;
    justify-content:center;
    width:100%;
  }
  details.cuts{
    width: var(--control-w);
    margin: 4px auto 0 auto;
    border:1px solid var(--border);
    border-radius:12px;
    background: var(--off);
    text-align:center;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  details.cuts > summary{
    width:100%;
    padding:10px 12px;
    cursor:pointer;
    list-style:none;
    font-weight:700;
    color:var(--ink);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
  }
  /* dropdown icon */
  details.cuts > summary::after{
    content:"▾";
    display:inline-block;
    transition: transform .2s ease;
  }
  details.cuts[open] > summary::after{
    transform: rotate(180deg);
  }
  details.cuts[open] > summary{
    border-bottom:1px solid var(--border);
    border-bottom-left-radius:0;
    border-bottom-right-radius:0;
  }
  .cuts-content{
    width:100%;
    padding:12px;
    display:flex;
    flex-direction:column;
    align-items:center;   /* center inner content */
    gap:8px;
  }
  .cuts-subtitle{
    margin:6px auto 4px auto;
    font-size:15px;
    font-weight:700;
    color:var(--ink);
    text-align:center;
  }
  .cuts-grid{
    width: min(520px, 100%);
    margin: 0 auto 8px auto;  /* centered */
    border-collapse: collapse;
  }
  .cuts-grid th, .cuts-grid td{
    border:1px solid var(--border);
    padding:8px;
    text-align:center;
    font-size:14px;
  }
  .cuts-grid th{
    background:#fff;
    font-weight:700;
  }

  /* Emphasized Goal box — centerpiece, same width as controls */
  .goal-wrap{
    background: var(--off);
    border:1px solid var(--border);
    border-radius:16px;
    padding:16px;
    box-shadow: 0 8px 24px rgba(0,0,0,.06);
  }
  #goal{
    width:100%;
    padding:18px 20px;
    border-radius:12px;
    border:2px solid var(--ink);
    background:#fff; color:var(--ink);
    font-size: clamp(24px, 6vw, 32px);
    font-weight:800;
    text-align:center;
  }

  .error{
    color:var(--danger);
    font-size:14px;
    min-height:20px;
    text-align:center;
    margin-top:4px;
  }

  /* Results */
  .results{ margin-top: 12px; }

  /* 3-pill layout (200/400/500) */
  .results.three{
    display:grid;
    grid-template-columns: 1fr;
    gap:12px;
    justify-items:center;
  }
  @media (min-width:720px){
    .results.three{ grid-template-columns: repeat(3, minmax(180px, 1fr)); }
  }

  /* 2-pill centered layout (100s) */
  .results.two{
    display:flex;
    justify-content:center;
    gap:12px;
    flex-wrap:wrap;
  }

  .pill{
    border:1px solid var(--border);
    border-radius:16px;
    padding:12px;
    text-align:center;
    min-width: 180px;
    max-width: 100%;
    background: var(--off);
  }
  .pill .tag{
    font-size:12px; color:var(--muted); margin-bottom:4px;
  }
  .pill .num{
    font-variant-numeric: tabular-nums;
    font-size:clamp(22px, 5vw, 30px);
    font-weight:800;
  }

  /* Pill backgrounds */
  #pillFirst{ background: var(--light-green) }
  #pillMiddle{ background: var(--light-yellow) }
  #pillLast{ background: var(--gold) }

  /* Strategy — strong and visible on iPhone */
  .strategy{
    margin-top:16px;
    color: var(--danger);
    text-align:center;
    font-size:16px;
    font-weight:800;
    background: #fff1f1;
    border:1px solid #ffd0d0;
    border-radius:12px;
    padding:12px 14px;
  }

  .help{
    margin-top:16px;
    color:var(--muted);
    font-size:14px;
    text-align:center;
  }
</style>
</head>
<body>
  <div class="wrap">
    <main class="card" role="main" aria-labelledby="title">
      <!-- Top centered image -->
      <img class="logo" src="https://github.com/coachweaver/pace-app/blob/main/Badge%20Color%20(1).png?raw=true" alt="Team Badge" />

      <h1 id="title">Race Pace Calculator</h1>

      <!-- Controls (all centered, same width) -->
      <div class="controls">
        <!-- Event buttons grid -->
        <div class="field">
          <label for="eventButtons">Event</label>
          <div id="eventButtons" class="event-grid" role="group" aria-label="Event selection">
            <button class="btn" data-event="100 FR" aria-pressed="false">100 FR</button>
            <button class="btn" data-event="200 FR" aria-pressed="false">200 FR</button>
            <button class="btn" data-event="400/500 FR" aria-pressed="false">400/500 FR</button>
            <button class="btn" data-event="100 BR" aria-pressed="false">100 BR</button>
            <button class="btn" data-event="100 BK" aria-pressed="false">100 BK</button>
            <button class="btn" data-event="100 FLY" aria-pressed="false">100 FLY</button>
          </div>
        </div>

        <!-- Course buttons (only when 400/500 FR is selected) -->
        <div class="field" id="courseWrap" hidden>
          <label for="courseButtons">Course</label>
          <div id="courseButtons" class="course-buttons" role="group" aria-label="Course selection">
            <button class="btn" data-course="SCM" aria-pressed="false">SCM</button>
            <button class="btn" data-course="SCY" aria-pressed="false">SCY</button>
          </div>
        </div>

        <!-- Expandable State Cuts (CENTERED) -->
        <div class="cuts-wrap">
          <details class="cuts" id="cutsBox">
            <summary>2025 State Cuts</summary>
            <div class="cuts-content">
              <div class="cuts-subtitle">Women</div>
              <table class="cuts-grid" aria-label="Women state cuts">
                <thead>
                  <tr>
                    <th></th>
                    <th>SCY</th>
                    <th>SCM</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>AUTO</th>
                    <td id="w-scy-auto">—</td>
                    <td id="w-scm-auto">—</td>
                  </tr>
                  <tr>
                    <th>CONS</th>
                    <td id="w-scy-cons">—</td>
                    <td id="w-scm-cons">—</td>
                  </tr>
                </tbody>
              </table>

              <div class="cuts-subtitle">Men</div>
              <table class="cuts-grid" aria-label="Men state cuts">
                <thead>
                  <tr>
                    <th></th>
                    <th>SCY</th>
                    <th>SCM</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>AUTO</th>
                    <td id="m-scy-auto">—</td>
                    <td id="m-scm-auto">—</td>
                  </tr>
                  <tr>
                    <th>CONS</th>
                    <td id="m-scy-cons">—</td>
                    <td id="m-scm-cons">—</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </details>
        </div>

        <!-- Emphasized Goal Input (centerpiece) -->
        <div class="field goal-wrap">
          <label for="goal">Goal time</label>
          <input id="goal" type="text" inputmode="text"
                 placeholder="m:ss or ss"
                 aria-describedby="err" />
        </div>
      </div>

      <div class="error" id="err" role="alert" aria-live="polite"></div>

      <!-- Results -->
      <section aria-live="polite" aria-atomic="true">
        <div id="results" class="results three" hidden>
          <div class="pill" id="pillFirst">
            <div class="tag">First 50 Pace</div>
            <div class="num" id="firstNum">—</div>
          </div>
          <div class="pill" id="pillMiddle">
            <div class="tag">Middle 50s Pace</div>
            <div class="num" id="middleNum">—</div>
          </div>
          <div class="pill" id="pillLast">
            <div class="tag">Final 50 Pace</div>
            <div class="num" id="lastNum">—</div>
          </div>
        </div>

        <!-- Strategy (red, bold) -->
        <div id="strategy" class="strategy" hidden></div>

        <!-- Single-line description at the very bottom -->
        <div class="help">
          Time formats accepted: <strong>m:ss</strong>, <strong>seconds</strong>
        </div>
      </section>
    </main>
  </div>

<script>
  // ------ Elements
  const eventButtons = document.getElementById('eventButtons');
  const courseWrap   = document.getElementById('courseWrap');
  const courseButtons= document.getElementById('courseButtons');
  const goal         = document.getElementById('goal');
  const err          = document.getElementById('err');
  const results      = document.getElementById('results');
  const pillMiddle   = document.getElementById('pillMiddle');
  const firstNum     = document.getElementById('firstNum');
  const middleNum    = document.getElementById('middleNum');
  const lastNum      = document.getElementById('lastNum');
  const strategyBox  = document.getElementById('strategy');

  // State cuts cells
  const cells = {
    w: {
      scyAuto: document.getElementById('w-scy-auto'),
      scmAuto: document.getElementById('w-scm-auto'),
      scyCons: document.getElementById('w-scy-cons'),
      scmCons: document.getElementById('w-scm-cons')
    },
    m: {
      scyAuto: document.getElementById('m-scy-auto'),
      scmAuto: document.getElementById('m-scm-auto'),
      scyCons: document.getElementById('m-scy-cons'),
      scmCons: document.getElementById('m-scm-cons')
    }
  };

  // Current selections
  let currentEvent = null;
  let currentCourse = null; // must be explicitly chosen for 400/500

  // Strategy lines (your 3)
  const STRATEGIES = [
    "Are you going to rush your underwaters? No, no you're not.",
    "Let you hatred for the Red Dolphin pull you forward!!",
    "It's important to breathe. Just make sure you kick faster and breathe quick when you do!"
  ];

  // Pacing rules
  const RULES = {
    "100 FR":     { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 BK":     { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 FLY":    { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 BR":     { N: 2, deltas: { first: 4.5, last: 0.0 } },
    "200 FR":     { N: 4, deltas: { first: 3.0, last: 0.0 } },
    "400/500 FR": { NByCourse: { SCM: 8, SCY: 10 }, deltas: { first: 3.0, last: 1.0 } }
  };

  // 2025 SC State Cuts (filtered)
  // Stored as: [AUTO, CONS] for SCY/SCM per gender
  const CUTS = {
    "100 FR": {
      Women: { SCY: ["1:00.41","1:12.49"], SCM: ["1:07.18","1:20.61"] },
      Men:   { SCY: ["54.72","1:05.66"],   SCM: ["1:00.79","1:12.95"] }
    },
    "200 FR": {
      Women: { SCY: ["2:12.45","2:38.94"], SCM: ["2:26.75","2:56.11"] },
      Men:   { SCY: ["2:04.96","2:29.95"], SCM: ["2:18.46","2:46.15"] }
    },
    "100 FLY": {
      Women: { SCY: ["1:07.95","1:21.54"], SCM: ["1:15.49","1:30.59"] },
      Men:   { SCY: ["1:00.90","1:13.08"], SCM: ["1:07.84","1:21.41"] }
    },
    "100 BK": {
      Women: { SCY: ["1:09.06","1:22.87"], SCM: ["1:16.73","1:32.07"] },
      Men:   { SCY: ["1:03.93","1:16.72"], SCM: ["1:11.03","1:25.23"] }
    },
    "100 BR": {
      Women: { SCY: ["1:17.53","1:33.04"], SCM: ["1:26.21","1:43.46"] },
      Men:   { SCY: ["1:10.72","1:24.86"], SCM: ["1:18.50","1:34.20"] }
    },
    // 500y/400m
    "400/500 FR": {
      Women: { SCY: ["5:57.33","7:08.80"], SCM: ["6:16.14","7:34.45"] },
      Men:   { SCY: ["5:36.88","6:44.26"], SCM: ["5:54.94","7:05.28"] }
    }
  };

  // ------ Helpers
  function setActiveButton(groupEl, btn){
    groupEl.querySelectorAll('.btn').forEach(b=>{
      b.classList.remove('btn--active');
      b.setAttribute('aria-pressed','false');
    });
    if (btn){
      btn.classList.add('btn--active');
      btn.setAttribute('aria-pressed','true');
    }
  }

  function toggleCourse(){
    const isLong = currentEvent === '400/500 FR';
    courseWrap.hidden = !isLong;
  }

  function setResultsLayout(){
    const isHundred = currentEvent && currentEvent.startsWith('100 ');
    if (isHundred){
      pillMiddle.style.display = 'none';
      results.classList.remove('three');
      results.classList.add('two');   // center two pills
    }else{
      pillMiddle.style.display = '';
      results.classList.remove('two');
      results.classList.add('three');
    }
  }

  function updateCuts(){
    // Reset
    Object.values(cells.w).forEach(el=>el.textContent="—");
    Object.values(cells.m).forEach(el=>el.textContent="—");

    if (!currentEvent || !CUTS[currentEvent]) return;

    const evCuts = CUTS[currentEvent];
    // Women
    cells.w.scyAuto.textContent = evCuts.Women.SCY?.[0] || "—";
    cells.w.scyCons.textContent = evCuts.Women.SCY?.[1] || "—";
    cells.w.scmAuto.textContent = evCuts.Women.SCM?.[0] || "—";
    cells.w.scmCons.textContent = evCuts.Women.SCM?.[1] || "—";
    // Men
    cells.m.scyAuto.textContent = evCuts.Men.SCY?.[0] || "—";
    cells.m.scyCons.textContent = evCuts.Men.SCY?.[1] || "—";
    cells.m.scmAuto.textContent = evCuts.Men.SCM?.[0] || "—";
    cells.m.scmCons.textContent = evCuts.Men.SCM?.[1] || "—";
  }

  function parseTimeFlexible(str){
    if (!str) return null;

    // Digits-only seconds
    if (/^\d+$/.test(str)) {
      const sec = Number(str);
      if (sec < 44) return null;   // must be >= 44 seconds
      if (sec > 480) return null;  // cap at 8:00
      return sec;
    }

    // m:ss
    if (!str.includes(':')) return null;
    const [mStr, sStr] = str.split(':').map(s => s.trim());
    if (!/^\d{1,2}$/.test(mStr) || !/^\d{1,2}$/.test(sStr)) return null;
    const m = Number(mStr), s = Number(sStr);
    if (s >= 60) return null;
    const total = m * 60 + s;
    if (total < 44 || total > 480) return null;
    return total;
  }

  function formatWhole(val){
    return val < 10 ? '0' + val : '' + val;
  }

  function pickDeltas(){
    if (!currentEvent) return null;
    if (currentEvent === '400/500 FR'){
      if (!currentCourse) return null; // course must be selected
      const N = RULES['400/500 FR'].NByCourse[currentCourse];
      const d = RULES['400/500 FR'].deltas;
      return { first: d.first, last: d.last, N };
    }
    const r = RULES[currentEvent];
    return { first: r.deltas.first, last: r.deltas.last, N: r.N };
  }

  function showDashes(){
    firstNum.textContent = '—';
    middleNum.textContent = '—';
    lastNum.textContent   = '—';
  }

  function calculate(){
    err.textContent = '';

    if (!currentEvent){
      results.hidden = true;
      strategyBox.hidden = true;
      err.textContent = 'Select an event.';
      return;
    }

    const total = parseTimeFlexible(goal.value.trim());
    if (total == null){
      results.hidden = true;
      strategyBox.hidden = true;
      err.textContent = 'Enter m:ss or seconds';
      return;
    }

    // Layout set based on event
    setResultsLayout();
    results.hidden = false;

    const picked = pickDeltas();
    if (!picked){
      // If 400/500 and no course chosen: show dashes, no error
      showDashes();
      strategyBox.hidden = true; // avoid strategy until actual paces are shown
      return;
    }

    const { first: dFirst, last: dLast, N } = picked;

    // Solve middle pace:
    // total = N*middle - (dFirst + dLast)  => middle = (total + dFirst + dLast)/N
    const middle = (total + dFirst + dLast) / N;
    const first = middle - dFirst;
    const last  = middle - dLast;

    const firstR  = Math.round(first);
    const middleR = Math.round(middle);
    const lastR   = Math.round(last);

    firstNum.textContent  = formatWhole(firstR) + ' s';
    middleNum.textContent = formatWhole(middleR) + ' s';
    lastNum.textContent   = formatWhole(lastR) + ' s';

    // Strategy (strong + visible)
    const STRAT = STRATEGIES[Math.floor(Math.random()*STRATEGIES.length)];
    strategyBox.textContent = STRAT;
    strategyBox.hidden = false;
  }

  // ------ Event listeners
  function handleEventButton(btn){
    const ev = btn.getAttribute('data-event');
    currentEvent = ev;
    setActiveButton(eventButtons, btn);
    // Reset/Toggle course UI
    if (ev === '400/500 FR'){
      courseWrap.hidden = false;
      // keep currentCourse as-is until user taps; start as null
    } else {
      courseWrap.hidden = true;
      currentCourse = null;
      setActiveButton(courseButtons, null);
    }
    updateCuts();
    calculate();
  }

  eventButtons.addEventListener('click', (e)=>{
    const btn = e.target.closest('.btn');
    if (!btn) return;
    handleEventButton(btn);
  });
  eventButtons.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' || e.key === ' '){
      const btn = e.target.closest('.btn');
      if (!btn) return;
      e.preventDefault();
      handleEventButton(btn);
    }
  });

  // Course buttons (SCM / SCY)
  courseButtons.addEventListener('click', (e)=>{
    const btn = e.target.closest('.btn');
    if (!btn) return;
    const crs = btn.getAttribute('data-course');
    currentCourse = crs;
    setActiveButton(courseButtons, btn);
    calculate();
  });
  courseButtons.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' || e.key === ' '){
      const btn = e.target.closest('.btn');
      if (!btn) return;
      e.preventDefault();
      btn.click();
    }
  });

  // Goal input — live update + Enter key
  goal.addEventListener('input', calculate);
  goal.addEventListener('keydown', e => { if (e.key === 'Enter'){ e.preventDefault(); calculate(); } });

  // Init
  updateCuts();
</script>
</body>
</html>