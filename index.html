<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Swim Pace Calculator</title>
<style>
  :root{
    --white:#ffffff;
    --off:#fafafa;
    --ink:#00205b;
    --muted:#415a8a;
    --gold:#e9dd90;
    --sky:#8dc8e8;
    --border:#e6e6e6;
    --danger:#b00020;
  }
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--white);
    color: var(--ink);
    min-height: 100dvh;
    display:flex; align-items:center; justify-content:center;
    padding:20px;
  }
  .card{
    width:min(860px, 96vw);
    background: linear-gradient(180deg, rgba(0,32,91,.02), rgba(0,32,91,.00));
    border:1px solid var(--border);
    border-radius:20px;
    box-shadow: 0 16px 40px rgba(0,0,0,.06);
    padding:22px;
  }
  h1{ margin:0 0 10px 0; font-size:clamp(20px,4.5vw,28px) }
  .row{ display:grid; grid-template-columns:1fr; gap:12px; margin:10px 0 16px }
  .field label{ display:block; font-size:14px; color:var(--muted); margin:0 0 6px 2px }
  select,input,button{
    width:100%; padding:12px 14px; border-radius:12px;
    border:1px solid var(--border); background:#fff; color:var(--ink);
    font-size:16px;
  }
  button{
    background: linear-gradient(180deg, var(--sky), #5aa6c7);
    color:#062a4f; font-weight:700; cursor:pointer;
    box-shadow: 0 6px 16px rgba(141,200,232,.35);
  }
  .error{ color:var(--danger); font-size:14px; min-height:20px }
  .results{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:6px }
  .pill{
    background: var(--off); border:1px solid var(--border);
    border-radius:16px; padding:12px; text-align:center;
  }
  .pill .tag{ font-size:12px; color:var(--muted); margin-bottom:4px }
  .pill .num{ font-variant-numeric: tabular-nums; font-size:clamp(22px,5vw,30px); font-weight:800 }
  .strategy{ margin-top:14px; color:var(--danger); text-align:center; font-size:15px; background:var(--off); border:1px solid var(--border); border-radius:12px; padding:10px }
  .help{ margin-top:12px; color:var(--muted); font-size:14px }
  @media (min-width:680px){
    .row{ grid-template-columns:1fr 1fr 1fr 1fr }
    .results{ grid-template-columns:repeat(3,1fr) }
  }
</style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Swim Pace Calculator</h1>

    <div class="row">
      <div class="field">
        <label for="event">Event</label>
        <select id="event" aria-label="Event">
          <option>100 FR</option>
          <option>200 FR</option>
          <option>400/500 FR</option>
          <option>100 BR</option>
          <option>100 BK</option>
          <option>100 FLY</option>
        </select>
      </div>

      <div class="field">
        <label for="course">Course</label>
        <select id="course" aria-label="Course">
          <option>SCM</option>
          <option>SCY</option>
        </select>
      </div>

      <div class="field" id="sexWrap" hidden>
        <label for="sex">Category</label>
        <select id="sex" aria-label="Category">
          <option>Men</option>
          <option>Women</option>
        </select>
      </div>

      <div class="field">
        <label for="goal">Goal time</label>
        <input id="goal" type="text" inputmode="numeric" placeholder="m:ss or mm:ss" aria-describedby="err" />
      </div>
    </div>

    <div class="row" style="grid-template-columns:1fr">
      <button id="calc" type="button">Calculate</button>
      <div id="err" class="error" role="alert" aria-live="polite"></div>
    </div>

    <section aria-live="polite" aria-atomic="true">
      <div id="results" class="results" hidden>
        <div class="pill" id="pillFirst">
          <div class="tag">First 50</div>
          <div class="num" id="firstNum">00 s</div>
        </div>
        <div class="pill" id="pillMiddle">
          <div class="tag">Middle 50s</div>
          <div class="num" id="middleNum">00 s</div>
        </div>
        <div class="pill" id="pillLast">
          <div class="tag">Final 50</div>
          <div class="num" id="lastNum">00 s</div>
        </div>
      </div>

      <div id="strategy" class="strategy" hidden></div>

      <div class="help">
        Enter a valid time m:ss up to 8:00. Outputs are rounded to whole seconds. 400 equals SCM, 500 equals SCY.
      </div>
    </section>
  </main>

<script>
  const eventSel = document.getElementById('event');
  const courseSel = document.getElementById('course');
  const sexWrap = document.getElementById('sexWrap');
  const sexSel = document.getElementById('sex');
  const goal = document.getElementById('goal');
  const calcBtn = document.getElementById('calc');
  const err = document.getElementById('err');
  const results = document.getElementById('results');
  const pillMiddle = document.getElementById('pillMiddle');
  const firstNum = document.getElementById('firstNum');
  const middleNum = document.getElementById('middleNum');
  const lastNum = document.getElementById('lastNum');
  const strategyBox = document.getElementById('strategy');

  // Strategies: your 3 lines
  const STRATEGIES = [
    "Are you going to rush your underwaters? No, no you're not.",
    "Let you hatred for the Red Dolphin pull you forward!!",
    "It's important to breathe. Just make sure you kick faster and breathe quick when you do!"
  ];

  // Pacing rules from your specs
  // For 100s: 50s should be X seconds apart (first faster), except BR which is 4.5 s
  // We'll implement as Δfirst = gap, Δlast = 0.
  const RULES = {
    "100 FR":   { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 BK":   { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 FLY":  { N: 2, deltas: { first: 3.0, last: 0.0 } },
    "100 BR":   { N: 2, deltas: { first: 4.5, last: 0.0 } },
    "200 FR":   { N: 4, deltasBySex: {
                    Men:   { first: 3.0, last: 0.0 },
                    Women: { first: 2.0, last: 0.0 }
                  } },
    "400/500 FR": { NByCourse: { SCM: 8, SCY: 10 }, deltas: { first: 3.0, last: 1.0 } }
  };

  function showSexIfNeeded(){
    sexWrap.hidden = !(eventSel.value === '200 FR');
  }

  function showHideMiddlePill(){
    // 100s have only First and Last
    const isHundred = eventSel.value.startsWith('100 ');
    pillMiddle.style.display = isHundred ? 'none' : '';
  }

  function parseTime(str){
    if (!str || !str.includes(':')) return null;
    const [mStr, sStr] = str.split(':').map(s => s.trim());
    if (!/^\d{1,2}$/.test(mStr) || !/^\d{1,2}$/.test(sStr)) return null;
    const m = Number(mStr), s = Number(sStr);
    if (s >= 60) return null;
    const total = m * 60 + s;
    if (total > 480) return null; // reject > 8:00
    return total;
  }

  function formatWhole(val){
    return val < 10 ? '0' + val : '' + val;
  }

  function pickDeltas(){
    const ev = eventSel.value;
    if (ev === '200 FR'){
      const bySex = RULES['200 FR'].deltasBySex[sexSel.value];
      return { first: bySex.first, last: bySex.last, N: RULES['200 FR'].N };
    }
    if (ev === '400/500 FR'){
      const N = RULES['400/500 FR'].NByCourse[courseSel.value]; // SCM->8, SCY->10
      const d = RULES['400/500 FR'].deltas;
      return { first: d.first, last: d.last, N };
    }
    // 100s
    const r = RULES[ev];
    return { first: r.deltas.first, last: r.deltas.last, N: r.N };
  }

  function calculate(){
    err.textContent = '';
    const total = parseTime(goal.value.trim());
    if (total == null){
      results.hidden = true;
      strategyBox.hidden = true;
      err.textContent = 'Enter m:ss up to 8:00, with seconds less than 60.';
      return;
    }

    const { first: dFirst, last: dLast, N } = pickDeltas();

    // Solve middle pace:
    // For any N: total = N*middle - (dFirst + dLast)
    // => middle = (total + dFirst + dLast)/N
    const middle = (total + dFirst + dLast) / N;

    const first = middle - dFirst;
    const last  = middle - dLast;

    // Round to whole seconds
    const firstR  = Math.round(first);
    const middleR = Math.round(middle);
    const lastR   = Math.round(last);

    // Update UI
    firstNum.textContent  = formatWhole(firstR) + ' s';
    middleNum.textContent = formatWhole(middleR) + ' s';
    lastNum.textContent   = formatWhole(lastR) + ' s';

    showHideMiddlePill();
    results.hidden = false;

    // Strategy
    strategyBox.textContent = STRATEGIES[Math.floor(Math.random()*STRATEGIES.length)];
    strategyBox.hidden = false;
  }

  // Auto-update on any change
  [eventSel, courseSel, sexSel, goal].forEach(el => {
    el.addEventListener('change', () => { showSexIfNeeded(); calculate(); });
    el.addEventListener('input', () => { calculate(); });
    el.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); calculate(); } });
  });
  calcBtn.addEventListener('click', calculate);

  // On load
  showSexIfNeeded();
  showHideMiddlePill();
</script>
</body>
</html>
